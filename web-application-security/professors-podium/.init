#!/bin/sh
export PYTHONDONTWRITEBYTECODE=1
mkdir -p /var/log/gunicorn

chmod -R -s /challenge
chmod 544 /challenge/wsgi.py

cd /opt/lecture
/bin/cp -rf /challenge/* .
rm -rf /challenge
ln -s /opt/lecture /challenge

gunicorn --daemon

find /usr/bin /usr/sbin /bin /sbin -perm -4000 -type f -exec chmod -s {} \; 2>/dev/null

until curl -fs localhost:80 >/dev/null; do sleep 0.1; done
